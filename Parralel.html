<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Paralellizing QuaSSE - Options and Approaches</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Paralellizing QuaSSE - Options and Approaches</h1>

<p>From the tutorial, begin with an unparallelized version. </p>

<p>Well start with a simulated tree. The tree simulation differs slightly from the other methods, because
there is no longer a canonical argument list (speciation and extinction rates are arbitrary functions of the
character state). Here is a set of functions; speciation rate is a sigmoidal function which ranges from 0.1
to 0.2 with an inflection point at x = 0, extinction is constant at rate 0.03, and the model of character
evolution is Brownian motion with diffusion parameter 0.025.</p>

<pre><code class="r"># set knitr options
opts_chunk$set(message = FALSE, warning = FALSE)
</code></pre>

<pre><code class="r">require(diversitree)
lambda &lt;- function(x) sigmoid.x(x, 0.1, 0.2, 0, 2.5)
mu &lt;- function(x) constant.x(x, 0.03)
char &lt;- make.brownian.with.drift(0, 0.025)
</code></pre>

<p>You can also embed plots, for example:</p>

<pre><code class="r">set.seed(1)
phy &lt;- tree.quasse(c(lambda, mu, char), max.taxa = 15, x0 = 0, single.lineage = FALSE)
plot(phy)
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAGwCAMAAABy/YdMAAAAA1BMVEX///+nxBvIAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6klEQVR4nO3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4NFRdAAGLcW1NAAAAAElFTkSuQmCC" alt="plot of chunk unnamed-chunk-3"/> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAGwCAMAAABy/YdMAAAAdVBMVEX9/v0AAAAAADkAAGUAOY8AZmUAZrU5AAA5ADk5AGU5OY85j485j7U5j9plAABlADllAGVlOTllOY9lZgBlZo9ltf2POQCPOTmPOWWPZgCPZo+P2/21ZgC1/v3ajzna/rXa/v39tWX924/927X9/rX9/tr9/v2dPu+5AAAAJ3RSTlP//////////////////////////////////////////////////wCDVpfZAAAACXBIWXMAAAsSAAALEgHS3X78AAAK8UlEQVR4nO3dC1PbVhCG4ahJIU0LTS+hl4CLXfD//4m1ZHERPibo7PFqt9/7zLQk05E41lsug5ajd1tIerf0ArAMwosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMKLIrwowosivCjCiyK8KMLnsznvui/WkxA+nbufvw7/2BA+g7vL/mN8/dNV9+F2e/f5Zrv54cZ4SsJncH3Rp77+7mv/p+2q6/sbEd5FZ7Pudr3v/9h9el+fbVcfbu+vLqwrIryLznqC3Uf73a+3ffiH/kaEd2ELvzrb/XOx+XTbf9Lvv8Tv/mZdEeFd2MKv39/sivf/Xg1/2m4+Wr+pJ7wP46f66647217/eNntuvff4n9n7k54H+av8bvv7a7MP7R5jvAuGoQfvra3Q3gXDcI3RngXhBdFeFGEF0V4UYQXRfg6xptbASx9BQ8kCb/0Aqwav4D7v2+fvalCeBdtX8D91dmzN3UI78L4AiajV/3fLraPbyoR3oX17tzz0av7q4vrL9uHN7UI7+LpBVR9azgZvdr96c/hfs34pg7hXXSFP83yNHq1+8swi/P4pg7hXdjCT0avto8Td6bBO8K7sIWfjl7t/ifYf21fWSYzCO/C+Kl+Mnq1/2L/+KYS4V2Yv8aLjl4RXnT0ivDNEd4F4etEuVrVCF8nytWqFu8GLeGdRXkphHcW5aUQ3lmUl0J4Z1FeCuGdRXkphHfW5KUMw3b3V5Zf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" alt="plot of chunk unnamed-chunk-3"/> </p>

<p>We need to specify the standard deviation for the states; here I will just assume that all taxa have a state
standard deviation of 1=200</p>

<pre><code class="r">states &lt;- phy$tip.state
states.sd &lt;- 1/200
</code></pre>

<p>Then, build the likelihood as usual. The difference compared with other models is that we have to specify
the speciation and extinction functions (here, sigmoid.x and constant.x, respectively). There are a
number of other provided functions (see ?constant.x for a list), but any function that takes x as the first
argument may be used.</p>

<pre><code class="r">lik &lt;- make.quasse(phy, states, states.sd, sigmoid.x, constant.x)
</code></pre>

<p>This can be used in ML calculations as usual. There is a starting.point.quasse function that may
be useful in selecting sensible starting points, but some effort is still required to convert this into a full
vector as it just returns constant rate speciation, extinction, and diffusion rates.</p>

<pre><code class="r">p &lt;- starting.point.quasse(phy, states)
p
</code></pre>

<pre><code>##    lambda        mu diffusion 
##   0.16108   0.02569   0.03164
</code></pre>

<p>Lets ignore drift: the argument list we need is:</p>

<pre><code class="r">lik.nodrift &lt;- constrain(lik, drift ~ 0)
argnames(lik.nodrift)
</code></pre>

<pre><code>## [1] &quot;l.y0&quot;      &quot;l.y1&quot;      &quot;l.xmid&quot;    &quot;l.r&quot;       &quot;m.c&quot;       &quot;diffusion&quot;
</code></pre>

<p>A sensible starting point here might be</p>

<pre><code class="r">p.start &lt;- c(p[1], p[1], mean(states), 1, p[2:3])
names(p.start) &lt;- argnames(lik.nodrift)
p.start
</code></pre>

<pre><code>##      l.y0      l.y1    l.xmid       l.r       m.c diffusion 
##   0.16108   0.16108   0.57097   1.00000   0.02569   0.03164
</code></pre>

<pre><code class="r">
# set lower bound
lower &lt;- c(0, 0, min(states), -Inf, 0, 0)
</code></pre>

<p>Then run find.mle, as usual. The control argument here just tells the subplex algorithm to use an
initial step size of 0.1 (rather than 1), which reduces the number of function evaluations somewhat.</p>

<pre><code class="r">time.f &lt;- system.time(fit &lt;- find.mle(lik.nodrift, p.start, control = list(parscale = 0.1), 
    lower = lower, verbose = 0))
time.f
</code></pre>

<pre><code>##    user  system elapsed 
##  543.00    0.01  543.93
</code></pre>

<p><em>Time of the find.mle function</em></p>

<p>Function took 9.0655 minutes to run. Given that the desired use case involves phylogenies of many hundreds of taxa, this is far too long. </p>

<h1>Introduction to ppso - Particle Swarm Optomization</h1>

<p>The package provides a few dummy functions to show it works - here is the rastrigin function that apparently is commonly used to test optimzation (new to me!)</p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/8/8b/Rastrigin_function.png" height="400px" width="300px" /></p>

<pre><code class="r">require(ppso)
# simple application (all file I/O disabled)
result &lt;- optim_pso(objective_function = rastrigin_function, projectfile = NULL, 
    logfile = NULL)
print(result)
</code></pre>

<pre><code>## $value
## [1] -1.989
## 
## $par
## [1] -0.006468 -0.021736
## 
## $function_calls
## [1] 200
## 
## $break_flag
## [1] &quot;max iterations reached&quot;
</code></pre>

<pre><code class="r">
# actual minimum -2 at (0,0)
result = optim_dds(objective_function = rastrigin_function, projectfile = NULL, 
    logfile = NULL)
print(result)
</code></pre>

<pre><code>## $value
## [1] -2
## 
## $par
## [1]  0.001933 -0.000820
## 
## $function_calls
## [1] 500
## 
## $break_flag
## [1] &quot;max number of function calls reached&quot;
</code></pre>

<p>The arguments</p>

</body>

</html>

